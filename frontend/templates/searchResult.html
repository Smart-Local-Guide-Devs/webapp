{%extends 'base.html'%}
{%load static%}
{%block headtag%}


<title>Search results</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!--Nav Bar-->
<link rel="stylesheet" type="text/css" href="{%static 'searchResult.css'%}">
{%endblock%}

{%block content%}

<div class="topnav">
    <div class="topFilter">
        <h3>Search result</h3>
        <div class='filterIcon'>
            <em class="fa fa-filter"></em>
            <ul class="filter">
                <label for="rating"> Min Average Rating : </label>
                <output id="ratingOutput">{{ rating }}</output>
                <input type="range" min="0" max="5" step="0.5" name="rating" id="ratingInput" value="{{ rating }}"
                    onchange="ratingOutput.value=value">


                <label for="installs"> Min Installs : </label>
                <output id="installsOutput">{{ installs }}</output>
                <input type="range" min="0" max="10000000" step="10000" name="installs" id="installsInput"
                    value="{{ installs }}" onchange="installsOutput.value=value">


                <label for="reviews"> Min reviews : </label>
                <output id="reviewsOutput">{{ reviews }}</output>
                <input type="range" min="0" max="100000" step="1000" name="reviews" id="reviewsInput"
                    value="{{ reviews }}" onchange="reviewsOutput.value=value">


                <label for="ratings"> Min ratings : </label>
                <output id="ratingsOutput">{{ ratings }}</output>
                <input type="range" min="0" max="100000" step="1000" name="ratings" id="ratingsInput"
                    value="{{ ratings }}" onchange="ratingsOutput.value=value">


                <label for="free">Only Free</label>
                {% if free == "true" %}
                <input type="checkbox" name="free" id="freeInput" value="true" checked>
                {% else %}
                <input type="checkbox" name="free" id="freeInput" value="true">
                {% endif %}

            </ul>
        </div>
    </div>
    <div class="formSearch">
        <form class="formFields " action="{% url 'front_search' %}" method="GET">
            <div>
                <input class="search" type="text" placeholder="Search" name="search_query" id="searchInput"
                    value="{{ search_query }}" />
            </div>
            <div>
                {% for genre_value in genres %}
                {% if genre_value in genre %}
                <input type="checkbox" class="form-select Genre Box" id="genreInput" name="genre"
                    value="{{ genre_value }}" checked>{{ genre_value }}
                {% else %}
                <input type="checkbox" class="form-select Genre Box" id="genreInput" name="genre"
                    value="{{ genre_value }}">{{ genre_value }}
                {% endif %}
                {% endfor %}
            </div>
            <div>
                <p>Order by</p>
                <select class="form-select Order Box" id="orderChoice" name="orderby">
                    <option value="-avg_rating">Average Rating</option>
                    <option value="-min_installs">Installs</option>
                    <option selected value="-reviews_count">Reviews</option>
                    <option value="-ratings_count" selected>Ratings</option>
                </select>
            </div>
            <div class="filterBox">
                <p>Filter</p>

                <ul class="filter">
                    <label for="rating"> Min Average Rating : </label>
                    <output id="ratingOutput">{{ rating }}</output>
                    <input type="range" min="0" max="5" step="0.5" name="rating" id="ratingInput" value="{{ rating }}"
                        onchange="ratingOutput.value=value">


                    <label for="installs"> Min Installs : </label>
                    <output id="installsOutput">{{ installs }}</output>
                    <input type="range" min="0" max="10000000" step="10000" name="installs" id="installsInput"
                        value="{{ installs }}" onchange="installsOutput.value=value">


                    <label for="reviews"> Min reviews : </label>
                    <output id="reviewsOutput">{{ reviews }}</output>
                    <input type="range" min="0" max="100000" step="1000" name="reviews" id="reviewsInput"
                        value="{{ reviews }}" onchange="reviewsOutput.value=value">


                    <label for="ratings"> Min ratings : </label>
                    <output id="ratingsOutput">{{ ratings }}</output>
                    <input type="range" min="0" max="100000" step="1000" name="ratings" id="ratingsInput"
                        value="{{ ratings }}" onchange="ratingsOutput.value=value">


                    <label for="free">Only Free</label>
                    {% if free == "true" %}
                    <input type="checkbox" name="free" id="freeInput" value="true" checked>
                    {% else %}
                    <input type="checkbox" name="free" id="freeInput" value="true">
                    {% endif %}

                </ul>

            </div>
            <button class="navButton" type="submit">
                <em class="fa fa-search"></em>
            </button>
        </form>
    </div>


</div>


<div class="Container">
    {%for app in search_results%}
    <div class="searchCard">
        <div class="appName">
            <h3>{{app.app_name}}</h3>
            <h6 style="color:grey">(
                {% for genre in app.genres %}
                {{ genre }},
                {% endfor %}
                )
            </h6>
        </div>
        <div class="appImg">
            <img class="dotImg" src="{{app.icon_link}}" alt="app icon">
            <div class="Btns">
                <div><a href="{% url 'front_get_app' %}?app_id={{ app.app_id }}"><button class="btn">
                            Details</button></a></div>
                <div><a href="{% url 'front_app_review' %}?app_id={{ app.app_id }}"><button
                            class="btn">Review</button></a></div>
            </div>
        </div>
    </div>
    {% empty %}
    <div>
        Could not find any apps that met your needs, if you have any suggetions please add them so that others can know.
        <form class="Form" action="{% url 'front_add_new_app' %}" method="post">
            {% csrf_token %}
            <input class="applink" type="text" name="app_playstore_link" placeholder="{{ add_app_status }}" />
            <button class="formBtn1" type="submit">ADD THIS APP</button>
        </form>
    </div>
    {%endfor%}
</div>
{% if search_results.has_previous %}
<a href="{{sub_url}}{{search_results.previous_page_number}}">Previous Page</a>
{% endif %}
<ol class='paging'>
    {% for i in search_results.paginator.page_range %}
    <a href="{{sub_url}}{{i}}" class="page-link">
        <li class="page-items"></li>
    </a>
    {% endfor %}
    {% if search_results.has_next %}
    <a href="{{sub_url}}{{search_results.next_page_number}}">Next Page</a>
    {% endif %}
</ol>

<script>
    $(document).ready(function () {
        $(".filterBox p").click(function () {
            console.log("clicked")
            $(".filterBox").toggleClass("activefilter");
        });
    });

    $(document).ready(function () {
        $(".filterIcon").click(function () {
            console.log("clicked")
            $(".filterIcon").toggleClass("activefilter");
        });
    });
</script>
{% endblock %}