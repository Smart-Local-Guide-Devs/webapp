{%extends 'base.html'%}
{%load static%}
{%block headtag%}

<!-- Nav bar-->



<link rel="stylesheet" type="text/css" href="{%static 'appPage.css'%}">

<!-- Rating Part-->
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Font Awesome Icon Library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">



<link rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css">

<script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>
</head>
<style type="text/css">
  .carousel {
    background: #C2EDCE;
    margin-top: 80px;

  }

  .carousel-cell {
    width: 100%;
    height: auto;
    min-height: 320px;
    max-height: 400px;
    margin-right: 50px;
    margin-left: 50px;
    margin-top: 50px;
    background: #53BAC1;
    border-radius: 5px;

  }

  .carousel-cell.is-selected {
    background: #53BAC1;
  }

  /* cell number */
  .carousel-cell:before {
    display: block;
    text-align: center;

    line-height: 200px;
    font-size: 80px;
    color: white;
  }

  .review {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    padding: 10px;
  }

  .userImg {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    background-color: #fff;

  }

  .abc {
    display: inline;
    justify-content: space-between;
    align-items: center;
  }

  .button {
    margin-top: 10px;
    padding: 3px;
    background: #53BAC1;
    border-radius: 5px;
    display: inline;
    align-items: center;
    justify-content: center;
    text-align: center;
    text-decoration: none;
    width: 150px;
    margin: auto;
    margin-top: 20px;
    margin-left: 120px;
    /* margin-left: 220px;
    margin-top: 20px; */
  }

  .button-item {
    align-items: center;
    text-align: center;
    margin-right: 10px;
  }

  .button-icon {
    margin-right: 10px;
  }
</style>
{%endblock%}
{%block content%}




<div class="Container">
  <div class="Card">
    <div class="card_com">
      <div>
        <img alt="app icon" class="cardimage" src="{{icon}}">
      </div>
      <div class="card_con">
        <h1>{{ title }}</h1>
        <p>{{ summary }}</p>
      </div>
    </div>
  </div>
  <div class="abc">
    <a href="{% url 'front_app_review' appId %}" class=""><button type="button" class="button"><span
          class="button-icon"><em class="fas fa-address-book"></em></span><span
          class="button-text">Review</span></button></a>
    <a href="{{ url }}" class=""><button type="button" class="button">
        <span class="button-icon"><em class="fab fa-google-play"></em></span>
        <span class="button-text">Download</span>
      </button></a>
  </div>

  <div class="cardur">
    <span class="heading">User Rating</span>
    {%if score == 5%}
    <span class="fa fa-star checked"></span>
    <span class="fa fa-star checked"></span>
    <span class="fa fa-star checked"></span>
    <span class="fa fa-star checked"></span>
    <span class="fa fa-star checked"></span>
    {% elif  score <= 5 and score >= 4 %}
    <span class="fa fa-star checked"></span>
    <span class="fa fa-star checked"></span>
    <span class="fa fa-star checked"></span>
    <span class="fa fa-star checked"></span>
    <span class="fa fa-star"></span>

    {% elif  score <= 4 and score >= 3 %}
    <span class="fa fa-star checked"></span>
    <span class="fa fa-star checked"></span>
    <span class="fa fa-star checked"></span>
    <span class="fa fa-star"></span>
    <span class="fa fa-star"></span>

    {% elif  score <= 3 and score >= 2 %}
    <span class="fa fa-star checked"></span>
    <span class="fa fa-star checked"></span>
    <span class="fa fa-star"></span>
    <span class="fa fa-star"></span>
    <span class="fa fa-star"></span>

    {% elif  score <= 2 and score >= 1 %}
    <span class="fa fa-star checked"></span>
    <span class="fa fa-star "></span>
    <span class="fa fa-star"></span>
    <span class="fa fa-star"></span>
    <span class="fa fa-star"></span>
    {%endif%}

    <p>{{ score }} average based on {{ ratings }} reviews.</p>

    <div class="row">
      <div class="side">
        <div>5 star</div>
      </div>
      <div class="middle">
        <div class="bar-container">
          <div class="bar-5" style="width: {% widthratio histogram.4 ratings 100 %}%;"></div>
        </div>
      </div>
      <div class="side right">
        <div>{{ histogram.4 }}</div>
      </div>
      <div class="side">
        <div>4 star</div>
      </div>
      <div class="middle">
        <div class="bar-container">
          <div class="bar-4" style="width: {% widthratio histogram.3 ratings 100 %}%;"></div>
        </div>
      </div>
      <div class="side right">
        <div>{{ histogram.3 }}</div>
      </div>
      <div class="side">
        <div>3 star</div>
      </div>
      <div class="middle">
        <div class="bar-container">
          <div class="bar-3" style="width: {% widthratio histogram.2 ratings 100 %}%;"></div>
        </div>
      </div>
      <div class="side right">
        <div>{{ histogram.2 }}</div>
      </div>
      <div class="side">
        <div>2 star</div>
      </div>
      <div class="middle">
        <div class="bar-container">
          <div class="bar-2" style="width: {% widthratio histogram.1 ratings 100 %}%;"></div>
        </div>
      </div>
      <div class="side right">
        <div>{{ histogram.1 }}</div>
      </div>
      <div class="side">
        <div>1 star</div>
      </div>
      <div class="middle">
        <div class="bar-container">
          <div class="bar-1" style="width: {% widthratio histogram.0 ratings 100 %}%;"></div>
        </div>
      </div>
      <div class="side right">
        <div>{{ histogram.0 }}</div>
      </div>
    </div>
  </div>


  <h1 style="text-align: center">Our Reviews</h1>

  <div class="carousel" data-flickity='{ "groupCells": false }'>
    {% for review in reviews %}
    <div class="carousel-cell">
      <div class="review">
        <div class="userName">
          <h3>{{review.username}} from {{review.city}}</h3>
        </div>
        <div class="rating">
          {% if  review.rating == 5 %}
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          {% elif  review.rating == 4  %}
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star"></span>
          {% elif  review.rating == 3  %}
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked "></span>
          <span class="fa fa-star "></span>
          <span class="fa fa-star"></span>
          {% elif  review.rating == 2 %}
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star "></span>
          <span class="fa fa-star "></span>
          <span class="fa fa-star"></span>
          {% elif  review.rating == 1  %}
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star "></span>
          <span class="fa fa-star "></span>
          <span class="fa fa-star "></span>
          <span class="fa fa-star"></span>
          {%endif%}
        </div>
        <div class="review content">
          {{review.content}}
          <br>
          {% for query_choice in review.query_choices %}
          {{ query_choice.query }}: {{ query_choice.choice }}
          <br>
          {% endfor %}
        </div>
        <form action="{% url 'api_up_vote_app' appId review.pk %}">
          {% csrf_token %}
          <button class="upvotes">
            <em class="fa fa-thumbs-up"></em>
            <span>{{review.up_votes}}</span>
          </button>
        </form>
        <form action="{% url 'api_down_vote_app' appId review.pk %}">
          {% csrf_token %}
          <button class="upvotes">
            <em class=" fa fa-thumbs-down"></em>
            <span>{{review.down_votes}}</span>
          </button>
        </form>
      </div>
    </div>
    {%endfor%}
  </div>

  <script>
    $('.upvotes').click(function () {
      $('.upvotes').prop('disabled', true);
      const form = $(this).parent();
      $.post(form.prop('action'), form.serialize()).always((resData) => {
        resData = resData.responseJSON;
        spans = $(this).parent().parent().children('form').children('button').children('span');
        spans[0] = resData['up_votes'];
        spans[1] = resData['down_votes'];
        alert(resData['message']);
        $('.upvotes').prop('disabled', false);
      });
      return false;
    });

  </script>

  <h1 style="text-align: center">Playstore Reviews</h1>

  <div class="carousel" data-flickity='{ "groupCells": false }'>
    {% for review in playstore_reviews %}
    <div class="carousel-cell">
      <div class="review">
        <img class="userImg" src="{{review.userImage}}" alt='user image'>
        <div class="userName">
          <h3>{{review.userName}}</h3>
        </div>
        <div class="rating">
          {% if  review.score == 5 %}
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          {% elif  review.score == 4  %}
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star"></span>
          {% elif  review.score == 3  %}
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked "></span>
          <span class="fa fa-star "></span>
          <span class="fa fa-star"></span>
          {% elif  review.score == 2 %}
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star "></span>
          <span class="fa fa-star "></span>
          <span class="fa fa-star"></span>
          {% elif  review.score == 1  %}
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star "></span>
          <span class="fa fa-star "></span>
          <span class="fa fa-star "></span>
          <span class="fa fa-star"></span>
          {%endif%}
        </div>
        <div class="review content">
          {{review.content}}
        </div>
        <div class='upvotes'>
          <em class="fa fa-thumbs-up"></em>
          <p>{{review.thumbsUpCount}}</p>
        </div>

      </div>
    </div>
    {%endfor%}
  </div>

  <div class="Services">
    <h1>Similar Apps</h1>
    <div class="carousel" data-flickity='{ "groupCells": false }'>
      {% for similar_app in similar_apps %}
      <div class=" serviceCard">
        <a href="{% url 'front_get_app' similar_app.app_id %}">
          <img class="serviceImage" src="{{ similar_app.icon_link }}" alt="app icon" />
        </a>
        <p>{{ similar_app.app_name }}</p>
        <p style="font-size:12px">{{similar_app.app_summary}}</p>
      </div>
      {% endfor %}
    </div>
  </div>

  <div class="Services">
    <h1>Customer also prefer</h1>
    <div class="carousel" data-flickity='{ "groupCells": false }'>
      <div class=" serviceCard  ">
        <div class="serviceImage"></div>
        <p>Service Name</p>
        <p style="font-size:12px">app summary</p>
      </div>
      <div class=" serviceCard  ">
        <div class="serviceImage"></div>
        <p>Service Name</p>
      </div>
      <div class=" serviceCard  ">
        <div class="serviceImage"></div>
        <p>Service Name</p>
      </div>
      <div class=" serviceCard  ">
        <div class="serviceImage"></div>
        <p>Service Name</p>
      </div>
    </div>
  </div>
</div>
{%endblock%}